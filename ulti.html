<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estatísticas de Confronto</title>
    <style>
        body {
            background-color: #1c1f26;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .container {
            background-color: #2a2d34;
            padding: 20px;
            border-radius: 8px;
        }
        h1 {
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #444;
            padding: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Estatísticas de Confronto entre Times</h1>
        
        <label for="timeA">Time Casa:</label>
        <select id="timeA">
            <option value="O. Caldas">O. Caldas</option>
            <option value="River">River</option>
            <option value="Boca">Boca</option>
            <option value="U. de Chile">U. de Chile</option>
            <option value="Penarol">Penarol</option>
            <option value="LDU">LDU</option>
            <option value="Mengo">Mengo</option>
            <option value="Los Verdiblancos">Los Verdiblancos</option>
            <option value="U. Catolica">U. Catolica</option>
            <option value="Estudiantes">Estudiantes</option>
            <option value="Nacional">Nacional</option>
            <option value="Peixe">Peixe</option>
            <option value="Los Albos">Los Albos</option>
            <option value="Timao">Timao</option>
            <option value="Atlético">Atlético</option>
            <option value="Olimpia">Olimpia</option>
            <option value="Cristal">Cristal</option>
            <option value="Verdao">Verdao</option>
            <option value="Deportes">Deportes</option>
            <option value="Tricolor paulista">Tricolor paulista</option>
        </select>
        
        <label for="timeB">Time Fora:</label>
        <select id="timeB">
            <option value="O. Caldas">O. Caldas</option>
            <option value="River">River</option>
            <option value="Boca">Boca</option>
            <option value="U. de Chile">U. de Chile</option>
            <option value="Penarol">Penarol</option>
            <option value="LDU">LDU</option>
            <option value="Mengo">Mengo</option>
            <option value="Los Verdiblancos">Los Verdiblancos</option>
            <option value="U. Catolica">U. Catolica</option>
            <option value="Estudiantes">Estudiantes</option>
            <option value="Nacional">Nacional</option>
            <option value="Peixe">Peixe</option>
            <option value="Los Albos">Los Albos</option>
            <option value="Timao">Timao</option>
            <option value="Atlético">Atlético</option>
            <option value="Olimpia">Olimpia</option>
            <option value="Cristal">Cristal</option>
            <option value="Verdao">Verdao</option>
            <option value="Deportes">Deportes</option>
            <option value="Tricolor paulista">Tricolor paulista</option>
        </select>
        
        <button onclick="obterResultados()">Buscar Estatísticas</button>
        
        <table id="tabelaEstatisticas">
            <thead>
                <tr>
                    <th>Total de Confrontos</th>
                    <th>Vitórias Casa</th>
                    <th>Vitórias Fora</th>
                    <th>Empates</th>
                    <th>Último Resultado</th>
                    <th>Ambas Sim</th>
                    <th>Ambas Não</th>
                    <th>Casa vence</th>
                    <th>Fora vence</th>
                    <th>Médias de gols</th>
                    <th>Over 1.5</th>
                    <th>Under 1.5</th>
                    <th>Over 2.5</th>
                    <th>Under 2.5</th>
                    <th>Over 3.5</th>
                    <th>Under 3.5</th>
                    <th>Over 5+</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="totalConfrontos">...</td>
                    <td id="vitoriasCasa">...</td>
                    <td id="vitoriasFora">...</td>
                    <td id="empates">...</td>
                    <td id="ultimoResultado">...</td>
                    <td id="ambasSim">...</td>
                    <td id="ambasNao">...</td>
                    <td id="casaVence">...</td>
                    <td id="foraVence">...</td>
                    <td id="mediaGols">...</td>
                    <td id="over1_5">...</td>
                    <td id="under1_5">...</td>
                    <td id="over2_5">...</td>
                    <td id="under2_5">...</td>
                    <td id="over3_5">...</td>
                    <td id="under3_5">...</td>
                    <td id="over5_plus">...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        async function obterResultados() {
            const timeA = document.getElementById('timeA').value; // Nome do Time A
            const timeB = document.getElementById('timeB').value; // Nome do Time B

            if (timeA === timeB) {
                alert('Os times selecionados não podem ser iguais.');
                return;
            }

            // Obtém todos os resultados
            const resposta = await fetch('https://servidorbetano.up.railway.app/resultados/Taça%20Glória%20eterna');
            const dados = await resposta.json();

            // Pega apenas as 480 entradas mais recentes
            const dadosRecentes = dados.slice(-480);

            // Filtra apenas os jogos entre os dois times
            const jogosAnteriores = dadosRecentes.filter(jogo => 
                (jogo.time_a === timeA && jogo.time_b === timeB) || 
                (jogo.time_a === timeB && jogo.time_b === timeA)
            );

            const estatisticas = processarEstatisticas(jogosAnteriores, timeA, timeB);

            // Atualiza o HTML com as estatísticas
            document.getElementById('totalConfrontos').textContent = estatisticas.totalConfrontos;
            document.getElementById('vitoriasCasa').textContent = estatisticas.vitoriasCasa;
            document.getElementById('vitoriasFora').textContent = estatisticas.vitoriasFora;
            document.getElementById('empates').textContent = estatisticas.empates;
            document.getElementById('ultimoResultado').textContent = estatisticas.ultimoResultado;
            document.getElementById('ambasSim').textContent = estatisticas.ambasSim;
            document.getElementById('ambasNao').textContent = estatisticas.ambasNao;
            document.getElementById('casaVence').textContent = estatisticas.casaVence;
            document.getElementById('foraVence').textContent = estatisticas.foraVence;
            document.getElementById('mediaGols').textContent = estatisticas.mediaGols.toFixed(2);
            document.getElementById('over1_5').textContent = estatisticas.over1_5;
            document.getElementById('under1_5').textContent = estatisticas.under1_5;
            document.getElementById('over2_5').textContent = estatisticas.over2_5;
            document.getElementById('under2_5').textContent = estatisticas.under2_5;
            document.getElementById('over3_5').textContent = estatisticas.over3_5;
            document.getElementById('under3_5').textContent = estatisticas.under3_5;
            document.getElementById('over5_plus').textContent = estatisticas.over5_plus;
        }

        function processarEstatisticas(jogosAnteriores, timeA, timeB) {
            let vitoriasCasa = 0;
            let vitoriasFora = 0;
            let empates = 0;
            let ambasSim = 0;
            let ambasNao = 0;
            let casaVence = 0;
            let foraVence = 0;
            let totalGols = 0;
            let over1_5 = 0;
            let under1_5 = 0;
            let over2_5 = 0;
            let under2_5 = 0;
            let over3_5 = 0;
            let under3_5 = 0;
            let over5_plus = 0;

            jogosAnteriores.forEach(jogo => {
                const [golsA, golsB] = jogo.ft.split(' x ').map(Number);
                totalGols += golsA + golsB;

                if (golsA > golsB) {
                    vitoriasCasa++;
                    casaVence++;
                } else if (golsA < golsB) {
                    vitoriasFora++;
                    foraVence++;
                } else {
                    empates++;
                }

                if (golsA > 0 && golsB > 0) ambasSim++;
                else ambasNao++;

                if (golsA + golsB > 1) over1_5++;
                else under1_5++;

                if (golsA + golsB > 2) over2_5++;
                else under2_5++;

                if (golsA + golsB > 3) over3_5++;
                else under3_5++;

                if (golsA + golsB > 5) over5_plus++;
            });

            return {
                totalConfrontos: jogosAnteriores.length,
                vitoriasCasa,
                vitoriasFora,
                empates,
                ultimoResultado: jogosAnteriores.length > 0 ? jogosAnteriores[jogosAnteriores.length - 1].ft : 'N/A',
                ambasSim,
                ambasNao,
                casaVence,
                foraVence,
                mediaGols: totalGols / jogosAnteriores.length || 0,
                over1_5,
                under1_5,
                over2_5,
                under2_5,
                over3_5,
                under3_5,
                over5_plus
            };
        }
    </script>
</body>
</html>
